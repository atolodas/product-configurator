jQuery(function(a){var b=800,c=800,d=600,e=400,f=1,g=1,h=[],i=[],j=[],k={},l=!1,m=!1,n=!0,o=null!=wpc_cart_redirect_items,p={},q={},r=null,s=jQuery("#wpc_product_stage").children("canvas").get(0),t=new fabric.Canvas(s,{selection:!1,hoverCursor:"default",rotationCursor:"default",centeredScaling:!0}),u=jQuery("#wpc_final_design").children("canvas").get(0),v=new fabric.Canvas(u,{selection:!1,hoverCursor:"default",rotationCursor:"default",centeredScaling:!0}),w=function(b,c,d){var e=!0;return""!==b&&b.find(".flclr").length&&b.find("i").length<=0&&(e=!1),""!==c&&c.find(".flclr").length&&c.find("i").length<=0&&(e=!1),"image"==r&&a(d).data("attribute")==wpc_emb_layer&&""===a("#wpc_product_emb_image").val()&&(e=!1),"text"==r&&a(d).data("attribute")==wpc_emb_layer&&(""!==a("#wpc_product_emb_text").val()&&""!==a("#wpc_product_emb_fontcolor").val()||(e=!1)),e},x=function(b,c){_.isEmpty(b)||(l=!0,a.each(b,function(b,c){var d=a(".wpc_attribute_button_"+c.attribute+"_"+c.term);a(d).trigger("click"),a("#wpc_attributes_values_"+c.attribute).parent().addClass("wpc_hidden"),a("#wpc1_attributes_values_"+c.attribute).parent().addClass("wpc_hidden")})),h=[],cords=[],i=[],j=[],k={},n=!0,"undefined"==typeof c&&(initialModel=defaultModel),R(),a("#embroidery_tab").addClass("wpc_hidden"),a(".variations_button").addClass("wpc_hidden"),a.isEmptyObject(actualCords)||(cords=actualCords),m=!1},y=function(){t.setWidth(a("#wpc_product_stage").width()),t.setHeight(b*t.getWidth()/c)},z=function(){var b=a("#wpc_final_design").width(),c=.67*b;v.setDimensions({width:b,height:c})},A=function(){for(var a=t.getObjects(),d=0;d<a.length;d++){var e=1/b*t.getHeight(),h=1/c*t.getWidth();if("base_image"==a[d].imageType&&"base_image"==a[d].imageClass&&(f=h,g=e),a[d].set({scaleX:h,scaleY:e}),"extraContent"==a[d].title){var i=k.top/k.stageHeight*t.getHeight(),j=k.left/k.stageWidth*t.getWidth();if("image"==a[d].objectType){var h=k.scaleX/k.stageWidth*t.getWidth(),e=k.scaleY/k.stageHeight*t.getHeight();a[d].set({scaleX:h,scaleY:e,left:j,top:i}),k.scaleX=h,k.scaleY=e}if("text"==a[d].objectType){var l=k.fontSize/k.stageWidth*t.getWidth();a[d].set({fontSize:l,left:j,top:i}),k.fontSize=l}k.top=i,k.left=j,k.stageHeight=t.getHeight(),k.stageWidth=t.getWidth()}a[d].setCoords()}t.renderAll().calcOffset()},B=function(b,c){var d=["base_image","texture_image"],e=a("#"+b+"_"+initialModel).data("attribute");a.each(d,function(d,f){var g=new fabric.Image(a("#"+b+"_"+initialModel).children("."+f).get(0),{hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,imageClass:f,imageType:c,attribute:e});t.add(g)}),t.renderAll().calcOffset()},C=function(b,c){O(b);var d=0,e=new Image;e.src=c.base,a(e).load(function(){if(0===d){var h=new fabric.Image(e,{hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,imageClass:"base_image",imageType:"cord_images",attribute:b,scaleX:f,scaleY:g});t.add(h);var i=new Image;i.src=c.texture;var k=0;if(a(i).load(function(){if(0==k){var a=new fabric.Image(i,{hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,imageClass:"texture_image",imageType:"cord_images",attribute:b,scaleX:f,scaleY:g});t.add(a),k+=1}}),t.renderAll().calcOffset(),d+=1,"undefined"!=typeof _.findWhere(j,{attribute:b})){var l=_.findWhere(j,{attribute:b});Q(b,l.color)}}})},D=function(b){a.isEmptyObject(b)||a.each(b,function(a,b){"undefined"!=typeof b.base&&""!==b.base&&"undefined"!=typeof b.texture&&""!==b.texture&&C(a,b)})},E=function(b,c){O(b);var d=new Image;d.src=a.parseJSON(c);var e=0;a(d).load(function(){if(0===e){var a=new fabric.Image(d,{hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,imageClass:"texture_image",imageType:"cord_images",attribute:b,scaleX:f,scaleY:g});t.add(a),e+=1}}),t.renderAll().calcOffset()},F=function(b){a.isEmptyObject(b)||(b=JSON.parse(b),a.each(b,function(b,c){if(""!==c){O(b);var d=0,e=new Image;e.src=c,a(e).load(function(){if(0===d){var a=new fabric.Image(e,{hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,imageClass:"texture_image",imageType:"cord_images",attribute:b,scaleX:f,scaleY:g});t.add(a),d+=1}})}t.renderAll().calcOffset()}))},G=function(){a("#wpc_product_stage").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var b={action:"wpc_get_static_images",model:initialModel,productId:productId};a.post(wpc_ajaxUrl.ajaxUrl,b,function(b){if(!a.isEmptyObject(b)){var c=a.parseJSON(b);a.each(c,function(b,c){"undefined"!=typeof c.base&&""!==c.base&&"undefined"!=typeof c.texture&&""!==c.texture&&(o&&a(document).trigger("staticimageload"),C(b,c))})}a(document).trigger("loadstatic"),a("#wpc_product_stage").unblock()})},H=function(b){a("#wpc_product_stage").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var c={action:"wpc_get_single_static_image",model:initialModel,productId:productId,attribute:b};a.post(wpc_ajaxUrl.ajaxUrl,c,function(c){var d=a.parseJSON(c);"undefined"!=typeof d.base&&""!==d.base&&"undefined"!=typeof d.texture&&""!==d.texture&&C(b,d),a("#wpc_product_stage").unblock()})},I=function(b,c,d,e,f){var g="color"==b?"#wpc_color_tab_"+c:"#wpc_texture_tab_"+c;a(g).block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var h="color"==b?"wpc_get_color_data":"wpc_get_texture_data",k={action:h,attribute:c,term:d,termId:e,model:defaultModel,productId:productId,buttonType:f};a.post(wpc_ajaxUrl.ajaxUrl,k,function(d){switch(b){case"color":if(a("#wpc_texture_tab_"+c).html(""),a(g).html(d),"undefined"!=typeof _.findWhere(j,{attribute:c})){var e=_.findWhere(j,{attribute:c});a("#wpc_color_tab_"+c+" .change_color[data-color='"+e.color+"']").length>0&&a("#wpc_color_tab_"+c+" .change_color[data-color='"+e.color+"']").trigger("click")}a(g).unblock();break;case"texture":if(a("#wpc_color_tab_"+c).html(""),a(g).html(d),"undefined"!=typeof _.findWhere(i,{attribute:c})){var f=_.findWhere(i,{attribute:c});a("#wpc_color_tab_"+c+" .change_texture[data-clean='"+f.texture+"']").length>0&&a("#wpc_color_tab_"+c+" .change_texture[data-clean='"+f.texture+"']").append('<i class="fa fa-check-circle"></i>')}a(g).unblock()}})},J=function(a){var b=_.without(j,_.findWhere(j,{attribute:a}));j=b;var b=_.without(i,_.findWhere(i,{attribute:a}));i=b,cords=_.without(cords,_.findWhere(cords,{attribute:a}))},K=function(a,b){switch(a){case"color":var c=_.without(j,_.findWhere(j,{attribute:b}));j=c;break;case"texture":var c=_.without(i,_.findWhere(i,{attribute:b}));i=c}},L=function(b){a("#wpc_product_stage").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var c={action:"wpc_get_image_data",attribute:b,cordsData:cords,model:initialModel,productId:productId};a.post(wpc_ajaxUrl.ajaxUrl,c,function(b){D(a.parseJSON(b)),a("#wpc_product_stage").unblock()})},M=function(){a("#wpc_product_stage").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var b={action:"wpc_get_texture_image_data",cordsData:cords,textureData:i,model:initialModel,productId:productId};a.post(wpc_ajaxUrl.ajaxUrl,b,function(b){F(b),a("#wpc_product_stage").unblock()})},N=function(b,c){a("#wpc_product_stage").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var d={action:"wpc_get_single_texture_image_data",texture:c,attribute:b,model:initialModel,productId:productId};a.post(wpc_ajaxUrl.ajaxUrl,d,function(c){E(b,c),a("#wpc_product_stage").unblock()})},O=function(a){for(var b=t.getObjects(),c=0;c<b.length;c++)b[c].attribute==a&&(t.remove(b[c]),c--);t.renderAll().calcOffset()},P=function(){t.clear(),B("wpc_base_images","base_image"),G()},Q=function(a,b){for(var c=t.getObjects(),d=0;d<c.length;d++)if(c[d].attribute==a&&"base_image"==c[d].imageClass){c[d].filters.push(new fabric.Image.filters.Tint({color:b})),c[d].applyFilters(t.renderAll.bind(t));break}t.renderAll().calcOffset()},R=function(){a(".wpc_emb_tabs ").removeClass("atv"),a(".wpc_emb_controls").addClass("wpc_hidden"),r=null,S()},S=function(){a("#wpc_font_select").html(""),a("#wpc_size_select").html(""),a("#wpc_text_add").val(""),a(".wpc_hidden_emb").val(""),a("#wpc_emb_colors").html(""),a("#wpc_emb_postion_buttons").html(""),a("#wpc_text_options").addClass("wpc_hidden"),a("#wpc_emb_colors").addClass("wpc_hidden"),a("#wpc_emb_postion_buttons").addClass("wpc_hidden"),a(".wpc_emb_rotate_buttons").addClass("wpc_hidden"),a("#wpc_image_upload").val(""),a(".wpc_emb_options").parent().addClass("wpc_hidden"),k={},T()},T=function(){for(var a=t.getObjects(),b=0;b<a.length;b++)"extraContent"==a[b].title&&(t.remove(a[b]),b--);t.renderAll().calcOffset()},U=function(a,d){var e={};return e.top=a*t.getHeight()/b,e.left=d*t.getWidth()/c,e},V=function(a){return a*t.getWidth()/c},W=function(a,b){if("undefined"==typeof _.findWhere(cords,{attribute:a}))cords.push({attribute:a,term:b});else{var c=_.without(cords,_.findWhere(cords,{attribute:a}));cords=c,cords.push({attribute:a,term:b})}},X=function(a){var b=t.getWidth()*a,c=t.getHeight()*a;t.setDimensions({height:c,width:b}),A();var d=t.toDataURL({format:"png",quality:1});return y(),A(),d},Y=function(b,c){a("#wpc_attributes_values_"+b).parent().removeClass("wpc_hidden"),a("#wpc_attributes_values_"+b).text(c)},Z=function(b,c,d){var e=a("#"+b+"_"+c);""!==d?e.parent().removeClass("wpc_hidden"):e.parent().addClass("wpc_hidden"),e.text(d)},$=function(b,c,d){var e=a("#wpc_emb_options_"+b),f=c.replace(/\n\r?/g,"<br />");a(e).parent().removeClass("wpc_hidden"),""===c&&a(e).parent().addClass("wpc_hidden"),d?a(e).html(f):a(e).text(c),a("#wpc_product_emb_"+b).val(c)},aa=function(b,c){a("#wpc_extra_item_"+b).val(c)},ba=function(b,c){a("#wpc_original_item_"+b).val(c);for(var d=t.getObjects(),e=0;e<d.length;e++);};fabric.Object.prototype.setOriginToCenter=function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var a=this.getCenterPoint();this.set({originX:"center",originY:"center",left:a.x,top:a.y})},fabric.Object.prototype.setCenterToOrigin=function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.set({originX:this._originalOriginX,originY:this._originalOriginY,left:a.x,top:a.y})};var ca=function(a,b,c){var d=!1;if(a){var e=a.getAngle()+b;"undefined"!=typeof c&&(e=b),"center"===a.originX&&"center"===a.originY||!a.centeredRotation||(a.setOriginToCenter&&a.setOriginToCenter(),d=!0),e=e>360?e-360:e<-360?-360-e:e,a.setAngle(e).setCoords(),d&&a.setCenterToOrigin&&a.setCenterToOrigin();var f=a.getAngle(),g=f>0?translate_text.right+" "+Math.abs(f):translate_text.left+" "+Math.abs(f);0!==f&&360!=f&&f!=-360?$("angle",g):$("angle",""),t.renderAll()}};a(document).on("click",".wpc_clear_all",function(a){a.preventDefault(),S(),R()}),y(),a(".variations_button").addClass("wpc_hidden"),a("#wpc_main_container").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:1,color:"#fff"}}),a(document).on("staticimageload",function(){var b=wpc_cart_redirect_items.variations;if(!_.isEmpty(b)){var c=1;a.each(b,function(b,d){setTimeout(function(){var c=a(".wpc_attribute_button_"+b.replace("attribute_","")+"_"+d);a(c).trigger("click")},100*c),c++,a("#wpc_main_container").unblock()})}});var da=!1;a(window).load(function(){a("#attribute-tabs").find(".wpc_original_item").detach().appendTo(a(".variations_form")),a("#attribute-tabs").find(".wpc_extra_item").detach().appendTo(a(".variations_form")),a("#attribute-tabs").responsiveTabs({rotate:!1,collapsible:"accordion",activate:function(b,c){var d=c.selector,e="undefined"!=typeof d&&"undefined"!=typeof a(d).data("attribute")&&null!=a(d).data("attribute")?a(d).data("attribute"):"",f=a("#wpc_color_tab_"+e),g=a("#wpc_texture_tab_"+e);_.isEmpty(p)&&_.isEmpty(q)?(q.tabId=c.id,q.colorDiv=f.length?f:"",q.textureDiv=g.length?g:"",q.tabDiv=d):(p.tabId=q.tabId,p.colorDiv=q.colorDiv,p.textureDiv=q.textureDiv,p.tabDiv=q.tabDiv,q.tabId=c.id,q.colorDiv=f.length?f:"",q.textureDiv=g.length?g:"",q.tabDiv=d),da&&(p={});var i=w("undefined"!=typeof p.colorDiv?p.colorDiv:"","undefined"!=typeof p.textureDiv?p.textureDiv:"","undefined"!=typeof p.tabDiv?p.tabDiv:"");i||(alert(translate_text.step_alert),da=!0,a("#attribute-tabs").responsiveTabs("activate",p.tabId)),da=!1;var j=a(d).find(".atv");if(a(j).hasClass("wpc_color_cords")&&I("color",a(j).data("attribute"),a(j).data("term"),a(j).data("id"),a(j).hasClass("wpc_static_layer")?"static_button":""),a(j).hasClass("wpc_texture_cords")&&I("texture",a(j).data("attribute"),a(j).data("term"),a(j).data("id"),a(j).hasClass("wpc_static_layer")?"static_button":""),""!==e&&!_.contains(h,e)){h.push(e);var k=a(d).find(".atv").data("display");Y(e,k)}}}),o||a("#wpc_main_container").unblock(),B("wpc_base_images","base_image"),G(),A()}),a(window).resize(function(){y(),A(),z()}),a(document).on("click",".wpc_terms",function(b){b.preventDefault();var c=a(this);if(c.hasClass("atv")&&!o)return!1;var d=c.data("attribute"),e=c.data("term"),f=c.data("id"),g=c.data("display");if(c.closest(".attribute_loop").find("button").removeClass("atv"),c.addClass("atv"),Y(d,g),a("#"+d).focusin().val(e).change(),c.hasClass("wpc_no_cords")&&(a("#wpc_color_tab_"+d).html(""),a("#wpc_texture_tab_"+d).html(""),J(d),L(d),M(),O(d),Z("wpc1_attributes_values",d,""),aa(d,"")),c.hasClass("wpc_color_cords")){if(K("texture",d),I("color",d,e,f,c.hasClass("wpc_static_layer")?"static_button":""),c.hasClass("wpc_static_layer"))return H(d),!1;W(d,e),L(d)}if(c.hasClass("wpc_texture_cords")){if(K("color",d),I("texture",d,e,f,c.hasClass("wpc_static_layer")?"static_button":""),c.hasClass("wpc_static_layer"))return!1;W(d,e)}if(c.hasClass("wpc_no_emb"))return R(),a("#embroidery_tab").addClass("wpc_hidden"),!1;if(c.hasClass("wpc_emb_buttons")&&(a("#embroidery_tab").removeClass("wpc_hidden"),n)){n=!1,a("#wpc_emb_buttons").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var h={action:"wpc_get_emb_button_data",model:defaultModel,productId:productId};a.post(wpc_ajaxUrl.ajaxUrl,h,function(b){var c=a.parseJSON(b);a("#wpc_emb_buttons").html(c.html),a("#wpc_emb_buttons").unblock(),"both"!=c.type&&a("#wpc_emb_buttons .wpc_emb_tabs[data-type='"+c.type+"']").length>0&&a("#wpc_emb_buttons .wpc_emb_tabs[data-type='"+c.type+"']").trigger("click")})}}),a(document).on("click",".wpc_model",function(b){var c=a(this);if(c.hasClass("atv")&&!l)return!1;l=!1;var d=c.data("attribute"),e=c.data("term"),f=c.data("id"),g=c.data("display");if(h.length>1&&!l&&!m){var i=confirm(translate_text.model_change);if(!i)return!1;defaultModel=f,c.hasClass("wpc_available_model")&&(initialModel=f);var j=_.without(defaultValues,_.findWhere(defaultValues,{attribute:d}));x(j,!0),P()}defaultModel=f,c.hasClass("wpc_available_model")&&(initialModel=f,P()),c.closest(".attribute_loop").find("a").removeClass("atv"),c.closest(".attribute_loop").find("i").remove(),c.addClass("atv"),c.parent().append('<i class="fa fa-check"></i>'),Y(d,g),a("#"+d).focusin().val(e).change()}),a(document).on("click",".change_color",function(b){b.preventDefault();var c=a(this);if(c.hasClass("active"))return!1;c.closest(".c-seclect").find(".change_color").removeClass("active"),c.addClass("active"),c.closest(".c-seclect").find("i").remove(),c.append('<i class="fa fa-check-circle"></i>');var d=c.data("attribute"),e=c.data("color"),f=c.data("display");if("undefined"==typeof _.findWhere(j,{attribute:d}))j.push({attribute:d,color:e});else{var g=_.without(j,_.findWhere(j,{attribute:d}));j=g,j.push({attribute:d,color:e})}Z("wpc1_attributes_values",d,f),Q(d,e),aa(d,f),ba(d,e)}),a(document).on("click",".change_texture",function(b){b.preventDefault();var c=a(this);if(c.hasClass("active"))return!1;var d=c.data("attribute"),e=(c.data("term"),c.data("clean")),f=c.data("display");if(c.closest(".c-seclect").find(".change_texture").removeClass("active"),c.addClass("active"),c.closest(".c-seclect").find("i").remove(),c.append('<i class="fa fa-check-circle"></i>'),"undefined"==typeof _.findWhere(i,{attribute:d}))i.push({attribute:d,texture:e});else{var g=_.without(i,_.findWhere(i,{attribute:d}));i=g,i.push({attribute:d,texture:e})}c.hasClass("static_button")?N(d,e):M(),Z("wpc1_attributes_values",d,f),aa(d,f),ba(d,e)}),a(document).on("click",".wpc_emb_tabs",function(b){b.preventDefault();var c=a(this);a(".wpc_emb_controls").addClass("wpc_hidden"),a(".wpc_emb_tabs").removeClass("atv"),a(c.attr("href")).removeClass("wpc_hidden"),a(c).addClass("atv"),S(),r=c.data("type"),$("type",c.text())}),a(document).on("click","#wpc_add_text_btn",function(b){b.preventDefault();var c=a("#wpc_text_add").val().trim();if(""!==c){a("#embroidery_tab").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var d={action:"wpc_get_emb_config",model:defaultModel,type:"text",productId:productId};a.post(wpc_ajaxUrl.ajaxUrl,d,function(b){var d=a.parseJSON(b);a("#wpc_font_select").html(d.fontOptions),a("#wpc_size_select").html(d.fontSizes),a("#wpc_emb_colors").html(d.colors),a("#wpc_emb_postion_buttons").html(d.positions),a("#wpc_text_options").removeClass("wpc_hidden"),a("#wpc_emb_colors").removeClass("wpc_hidden"),a("#wpc_emb_postion_buttons").removeClass("wpc_hidden"),a(".wpc_emb_rotate_buttons").removeClass("wpc_hidden"),T();var e=a("#wpc_emb_postion_buttons").find(".active").data("left");position_y=a("#wpc_emb_postion_buttons").find(".active").data("top"),actualPostions=U(position_y,e),tempfontSize=V(d.selectedFontSize),tempfontStyle=d.selectedFontStyle,positionText=a("#wpc_emb_postion_buttons").find(".active").text();var f=new fabric.Text(c,{title:"extraContent",objectType:"text",hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,top:actualPostions.top,left:actualPostions.left,fontSize:tempfontSize,fontFamily:tempfontStyle});t.add(f),t.renderAll(),k={objectType:"text",stageWidth:t.getWidth(),stageHeight:t.getHeight(),top:actualPostions.top,left:actualPostions.left,fontSize:tempfontSize},$("text",c,!0),$("fontsize",a("#wpc_size_select :selected").text()),$("font",a("#wpc_font_select :selected").text()),$("position",positionText),a("#wpc_text_add").val(""),a("#embroidery_tab").unblock()})}}),a(document).on("change","#wpc_image_upload",function(d){var e=/(.jpg|.gif|.png)$/;return!(""===a("#wpc_image_upload").val()&&!e.test(a("#wpc_image_upload").val()))&&(a("#wpc_product_stage").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}}),void a("#wpc_image_upload_form").ajaxSubmit({dataType:"json",data:{productId:productId,model:defaultModel},success:function(d,e,f,g){T(),a("#wpc_emb_postion_buttons").html(d.positions),a("#wpc_emb_postion_buttons").removeClass("wpc_hidden"),a(".wpc_emb_rotate_buttons").removeClass("wpc_hidden");var h=a("#wpc_emb_postion_buttons").find(".active").data("left"),i=a("#wpc_emb_postion_buttons").find(".active").data("top"),j=U(i,h),l=a("#wpc_emb_postion_buttons").find(".active").text();new fabric.Image.fromURL(d.filepath,function(e){var f=d.sizes.height,g=d.sizes.width,h=g/c*t.getWidth(),i=f/b*t.getHeight(),m=1;e.width>h&&(m=h/e.width),e.height>i&&(m=i/e.height),e.set({hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,left:j.left,top:j.top,scaleX:m,scaleY:m,title:"extraContent",objectType:"image"}),k={objectType:"image",stageWidth:t.getWidth(),stageHeight:t.getHeight(),top:j.top,left:j.left,scaleX:m,scaleY:m},t.add(e),t.calcOffset().renderAll(),$("image",'<a target="_blank" href="'+d.filepath+'">'+translate_text.image_file+"</a>",!0),$("position",l),a("#wpc_product_stage").unblock()})}}))}),a(document).on("click",".wpc_emb_btn",function(b){b.preventDefault();var c=a(this);if(c.hasClass("active"))return!1;var d=c.data("left"),e=c.data("top"),f=U(e,d),g=c.text();a("#wpc_emb_postion_buttons").find(".active").removeClass("active"),c.addClass("active");for(var h=t.getObjects(),i=0;i<h.length;i++)"extraContent"==h[i].title&&(h[i].set({top:f.top,left:f.left}),k.top=f.top,k.left=f.left,k.stageWidht=t.getWidth(),k.stageHeight=t.getHeight());t.renderAll().calcOffset(),$("position",g)}),a(document).on("click",".wpc_emb_rotate_buttons",function(b){b.preventDefault();var c=a(this),d=c.data("type"),e=parseFloat(a("#wpc_emb_angle").val());if(e>0&&e<360)for(var f=t.getObjects(),g=0;g<f.length;g++)if("extraContent"==f[g].title){switch(d){case"left":ca(f[g],-e);break;case"right":ca(f[g],e)}break}}),a(document).on("click",".wpc_emb_rotate_only",function(b){b.preventDefault();for(var c=a(this),d=c.data("angle"),e=t.getObjects(),f=0;f<e.length;f++)if("extraContent"==e[f].title){ca(e[f],-d);break}}),a(document).on("click","#wpc_reset_angle",function(b){b.preventDefault();for(var c=t.getObjects(),d=0;d<c.length;d++)if("extraContent"==c[d].title){ca(c[d],0,!0);break}a("#wpc_emb_angle").val(""),$("angle","")}),a(document).on("change","#wpc_font_select",function(){var b=a(this);if(""!==b.val()){for(var c=t.getObjects(),d=0;d<c.length;d++)if("text"==c[d].objectType){c[d].set({fontFamily:b.val()});break}t.renderAll(),$("font",a("#wpc_font_select :selected").text())}}),a(document).on("change","#wpc_size_select",function(){var b=a(this);if(""!==b.val()){for(var c=t.getObjects(),d=V(b.val()),e=0;e<c.length;e++)if("text"==c[e].objectType){c[e].set({fontSize:d}),k.stageHeight=t.getHeight(),k.stageWidht=t.getWidth(),k.fontSize=d;break}t.renderAll(),$("fontsize",a("#wpc_size_select :selected").text())}}),a(document).on("click",".change_color_emb",function(b){b.preventDefault();for(var c=a(this),d=c.data("color"),e=c.data("all").split("|"),f=e[0],g=t.getObjects(),h=0;h<g.length;h++)if("text"==g[h].objectType){g[h].set({fill:d});break}t.renderAll(),a(this).parent().parent().find("i").remove(),a(this).append('<i class="fa fa-check-circle"></i>'),$("fontcolor",f)}),a(document).on("keypress","#wpc_text_add",function(b){var c=a(this).val(),d=c.split("\n");if(d.length>wpc_emb_limit.line_limit)b.preventDefault(),c=c.substring(0,c.length-1),a(this).val(c);else for(var e=0;e<d.length;e++)d[e].length>wpc_emb_limit.character_limit&&(b.preventDefault(),d[e]=d[e].substring(0,d[e].length-1),c=d.join("\n"),a(this).val(c))}),a("#wpc_text_add").bind("cut copy paste",function(a){a.preventDefault()}),a(document).on("click","#wpc_bold_select",function(b){b.preventDefault();for(var c=a(this).attr("title"),d=t.getObjects(),e=0;e<d.length;e++)if("text"==d[e].objectType)switch(d[e].fontWeight){case"normal":d[e].set({fontWeight:"bold"}),$("fontweight",c);break;case"bold":d[e].set({fontWeight:"normal"}),$("fontweight","")}t.renderAll()}),a(document).on("click","#wpc_italic_select",function(b){b.preventDefault();for(var c=a(this).attr("title"),d=t.getObjects(),e=0;e<d.length;e++)if("text"==d[e].objectType)switch(d[e].fontStyle){case"":d[e].set({fontStyle:"italic"}),$("fontstyle",c);break;case"italic":d[e].set({fontStyle:""}),$("fontstyle","")}t.renderAll()}),a(document).on("click","#wpc_emb_extra_comment_button",function(b){b.preventDefault();var c=a("#wpc_emb_extra_comment_text").val();""!==c&&($("extra_comment",c,!0),a("#wpc_emb_extra_comment_text").val(""))}),a(document).on("click","#wpc_emb_extra_comment_button_remove",function(b){b.preventDefault(),a("#wpc_emb_extra_comment_text").val(""),$("extra_comment","")}),a(document).on("click","#wpc_product_stage",function(b){var d=a(window).width(),e=a(this);if(d<767)return!1;a("#tempForCloud").length&&a("#tempForCloud").remove(),a("#wpc_product_stage").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var f=e.offset(),g=t.toDataURL({format:"png",quality:1}),h=X(c/t.getWidth()),i='<img class="cloudzoom"  id ="zoom1" src="'+g+'" data-cloudzoom=\'zoomImage:"'+h+'",zoomSizeMode:"image",autoInside: 550\' />',j='<div id="tempForCloud" style="top:'+f.top+"px;left:"+f.left+"px;width:"+e.width()+"px;height:"+e.height()+'px;z-index:100;position:absolute">'+i+"</div>";a("body").append(j),a("#zoom1").CloudZoom(),a("#zoom1").bind("cloudzoom_ready",function(){a("#wpc_product_stage").unblock()}),a("#zoom1").bind("cloudzoom_end_zoom",function(){a("#tempForCloud").remove()}),a("#zoom1").bind("click",function(){var b=a(this).data("CloudZoom");b.closeZoom(),t.deactivateAllWithDispatch(),a.magnificPopup.open({items:{src:h},type:"image"},0)})}),a(document).on("change","#wpc_base_design_options",function(){var b=a(this);if(""===b.val())return v.clear(),!1;a("#wpc_final_design").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}});var c={action:"wpc_get_design_data",postId:b.val()};a.post(wpc_ajaxUrl.ajaxUrl,c,function(b){var c=JSON.parse(b);v.clear();var d=c.wpc_hidden_base_design,e=new Image;e.src=d;var f=0;z(),a(e).load(function(){if(0===f){var a=1;e.width>v.getWidth()&&(a=v.getWidth()/e.width),e.height>v.getHeight()&&(a=v.getHeight()/e.height);var b=new fabric.Image(e,{hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,imageType:"base_image",scaleX:a,scaleY:a});v.add(b).renderAll(),f+=1}}),a("#wpc_final_design").unblock()})}),a(document).on("click",".wpc_finish_product",function(b){if(b.preventDefault(),a("#wpc_nav_buttons").find("li").length-1!=h.length)return alert(translate_text.finish_all),!1;a("#wpc_product_additional_comment").val(a("#wpc_additional_comment_text").val());var f=a(".variations_form").find(".single_variation_wrap");a(f).is(":visible")?a(".variations_button").removeClass("wpc_hidden"):a(".variations_button").addClass("wpc_hidden");var g=X(c/t.getWidth()),i=a("#wpc_base_design_options").val();if(a("#wpc_final_design").block({message:"",overlayCSS:{border:"none",padding:"0",margin:"0",backgroundColor:"#fff",opacity:.6,color:"#fff"}}),""!==i){var j={action:"wpc_get_design_data",postId:i};a.post(wpc_ajaxUrl.ajaxUrl,j,function(a){for(var b=JSON.parse(a),c=v.getObjects(),f=!1,g=b.wpc_hidden_saddle_design,h=0;h<c.length;h++)"base_image"==c[h].imageType&&(f=!0),"finalDesign"==c[h].title&&(v.remove(c[h]),h--);if(f){var i=new Image;i.src=g;var j=i.height*b.wpc_saddle_scaleY,k=i.width*b.wpc_saddle_scaleX,l=j/e*v.getHeight(),m=k/d*v.getWidth(),n=1;t.getWidth()>m&&(n=m/t.getWidth()),t.getHeight()>l&&(n=l/t.getHeight());var o=b.wpc_saddle_pos_y/e*v.getHeight(),p=b.wpc_saddle_pos_x/d*v.getWidth(),q=new Image,r=X(n);q.onload=function(){var a=new fabric.Image(q,{top:o,left:p,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,title:"finalDesign"});v.add(a)},q.src=r}})}else{v.clear(),z();var k=1;t.getWidth()>v.getWidth()&&(k=v.getWidth()/t.getWidth()),t.getHeight()>v.getHeight()&&(k=v.getHeight()/t.getHeight());var l=X(1),m=new Image;m.onload=function(){var a=new fabric.Image(m,{top:0,left:0,scaleX:k,scaleY:k,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,title:"finalDesign"});v.add(a)},m.src=l}var j={action:"wpc_post_final_image",imageData:g};a.post(wpc_ajaxUrl.ajaxUrl,j,function(b){a("#wpc_product_image_data").val(b),a("#wpc_final_design").unblock()})}),a(document).on("keyup","#wpc_fake_qty",function(){a(".variations_form").find(".single_variation_wrap").find(".variations_button").find(".qty").val(a(this).val())}),a(document).on("click","#wpc_fake_add-to_cart",function(b){b.preventDefault(),a(".variations_form").find(".single_variation_wrap").find(".variations_button").find(".single_add_to_cart_button").trigger("click")}),a(document).on("click",".wpc-scroll",function(b){b.preventDefault();var c="#"+a(this).data("scroll"),d=a(window).width();d>767?a("html, body").animate({scrollTop:a(c).offset().top-100},"slow"):a("html, body").animate({scrollTop:a(c).offset().top},"slow")}),a(document).on("click",".wpc_finish_reset",function(b){b.preventDefault();var c=confirm(translate_text.reset_text);c&&(m=!0,x(defaultValues),a("#attribute-tabs").responsiveTabs("activate",0))})});
//# sourceMappingURL=wpc_frontend_script.min.js.map